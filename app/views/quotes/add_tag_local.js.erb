// Render a new #tag (x) based on the _tag.html.erb partial
quote_tags_container	= $(".quote-tags.q-<%= @quote.id %>");

<% if @flags[:flash] %>

	// Flash shit.
	quote_tags_container.children('.t-<%= @tag.id %>').fadeOut(100, function() {
		$(this).fadeIn(100);
	});

<% elsif @flags[:add] %>

	// UPDATE QUOTE:
	quote_tags_container.append("<%= escape_javascript(render :partial => 'quotes/tag', locals: { quote: @quote, tag: @tag }) %>");

	// UPDATE SIDEBAR:
	sidebar_tags_container = $(".sidebar-list.tags");
	taggings_count = <%= @board.occurrences_of(@tag) %>

	if (taggings_count == 1)
		sidebar_tags_container.append("<%= escape_javascript(render :partial => 'boards/tag', locals: { tag: @tag }) %>");
	else {
		sidebar_tag = sidebar_tags_container.children(".t-<%= @tag.id %>");
		sidebar_tag.find(".filter-count p").text(taggings_count);
	}
	
<% end %>

// Trigger DOMChange to assure jQuery events trigger on newly appended tag
$(document).trigger('DOMChange');