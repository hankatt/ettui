var quote_tags_container = $(".quote.q-<%= @quote.id %>").find('.quote-tags');
var sidebar_tags_container = $(".sidebar-list.tags");

<% if @flags[:add] %>
	quote_tags_container.append("<%= escape_javascript(render :partial => 'quotes/tag', locals: { quote: @quote, tag: @tag }) %>");

	tag_count = <%= @tag.context_count %>
	if (tag_count === 1)
		sidebar_tags_container.append("<%= escape_javascript(render :partial => 'shared/tag', locals: { tag: @tag }) %>");
	else {
		sidebar_tag = sidebar_tags_container.children(".t-<%= @tag.id %>");
		sidebar_tag.html("<%= escape_javascript(render :partial => 'shared/tag_data', locals: { tag: @tag }) %>");
	}
<% else %>
	quote_tags_container.children('.t-<%= @tag.id %>').fadeOut(100, function() {
		$(this).fadeIn(100);
	});
<% end %>

// Trigger DOMChange to assure jQuery events trigger on newly appended tag
$(document).trigger('DOMChange');